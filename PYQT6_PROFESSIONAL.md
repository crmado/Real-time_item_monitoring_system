## ✅ PyQt6 專業版完成！

`★ Insight ─────────────────────────────────────`
1. **雙模式支持**：創建了統一的源管理器，支持實體相機和視頻文件兩種輸入，讓你可以用錄製的視頻測試所有檢測算法
2. **完整檢測集成**：實現了圓形、輪廓、背景減除三種檢測算法，直接內建無需外部依賴，特別適合小零件檢測
3. **專業化界面**：優化UI佈局和配色，添加菜單欄快捷操作，狀態欄實時顯示，打造工業級專業體驗
`─────────────────────────────────────────────────`

---

# 🏭 Basler 工業視覺系統 - PyQt6 專業版

> 🎯 完整功能的桌面應用，支持相機/視頻雙模式測試

## 🚀 快速開始

### 立即運行

```bash
python basler_pyqt6/main_v2.py
```

就這麼簡單！

---

## ✨ 核心功能

### 1. 🎬 雙模式支持

#### 相機模式
- 連接 Basler 工業相機
- 280+ FPS 高速抓取
- 實時曝光調整

#### 視頻模式（測試用）
- 加載錄製的 MP4/AVI 視頻
- 循環播放測試檢測算法
- **無需實體相機即可測試所有功能**

### 2. 🔍 檢測算法

#### 圓形檢測
- 霍夫圓變換
- 適合圓形零件
- 可調參數：半徑範圍、精度

#### 輪廓檢測
- 形態學處理
- 適合不規則形狀
- 可調參數：閾值、核大小

#### 背景減除（推薦）
- **專為小零件設計**
- MOG2 背景建模
- 適合運動物體檢測
- 自動適應背景變化

### 3. 📊 實時監控

- CPU/記憶體使用率
- 實時 FPS 顯示
- 檢測物體計數
- 總幀數統計

### 4. 🎨 專業化界面

- 三欄佈局（控制-顯示-監控）
- 暗色主題設計
- 菜單欄快捷操作
- 狀態欄實時反饋

### 5. 🎥 視頻錄製

- 智能編碼器選擇（mp4v → MJPG → XVID）
- 自動檢測最佳幀率
- 實時幀計數顯示
- 錄製完成詳細信息
- 支持錄製帶檢測標記的視頻

---

## 📖 使用指南

### 測試模式（使用視頻文件）

這是**無需實體相機**的測試方法：

#### 步驟 1: 加載視頻

```
文件 > 📂 加載視頻文件...
```

選擇你之前錄製的視頻（如 `/basler_mvc/recordings/` 中的文件）

#### 步驟 2: 播放視頻

點擊 **▶️ 播放** 按鈕

#### 步驟 3: 啟用檢測

1. 在檢測面板選擇方法（推薦：**背景減除**）
2. 勾選 **✅ 啟用檢測**
3. 查看檢測結果

---

### 相機模式（實體相機）

#### 步驟 1: 切換到相機模式

```
模式 > 📷 相機模式
```

#### 步驟 2: 檢測並連接相機

1. 點擊 **🔍 檢測相機**
2. 選擇 Basler 相機
3. 點擊 **連接**

#### 步驟 3: 開始抓取

點擊 **▶️ 開始抓取**

---

## 🎥 視頻錄製功能

### 如何錄製視頻

#### 步驟 1: 啟動視頻源

先啟動相機或播放視頻：
- **相機模式**：連接相機 → 開始抓取
- **視頻模式**：加載視頻 → 播放

#### 步驟 2: 開始錄製

1. 在錄影面板點擊 **⏺️ 開始錄製**
2. 狀態欄顯示 **🔴 錄製中...**
3. 實時查看已錄製幀數

#### 步驟 3: 停止錄製

1. 點擊 **⏹️ 停止錄製**
2. 查看錄製統計信息：
   - 文件名
   - 總幀數
   - 錄製時長
   - 平均幀率
   - 編碼器類型

### 錄製功能特點

- **智能編碼器**：自動選擇 mp4v（高品質）→ MJPG（穩定）→ XVID（備用）
- **自動適應**：自動根據當前視頻源設置幀率和尺寸
- **帶檢測錄製**：如果啟用檢測，錄製視頻會包含檢測標記
- **實時反饋**：顯示已錄製幀數
- **完整信息**：停止時顯示詳細統計

### 錄製文件位置

```
basler_pyqt6/recordings/
├── recording_20240101_120000.mp4
├── recording_20240101_120500.avi
└── ...
```

---

## 🎯 檢測參數調整

雖然 UI 暫時沒有參數調整面板，但可以在代碼中修改：

```python
# basler_pyqt6/core/detection.py

self.params = {
    'min_area': 100,      # 最小面積
    'max_area': 5000,     # 最大面積
    'circle': {
        'dp': 1.2,
        'min_dist': 20,
        'param1': 50,
        'param2': 30,
        'min_radius': 5,
        'max_radius': 100
    },
    'contour': {
        'threshold': 127,
        'kernel_size': 3
    }
}
```

---

## 📁 項目結構

```
basler_pyqt6/
├── main_v2.py                 # ✅ 主程序（V2 專業版）
├── core/                      # ✅ 核心邏輯
│   ├── camera.py              # 相機控制器
│   ├── video_player.py        # 視頻播放器
│   ├── video_recorder.py      # 視頻錄製器
│   ├── source_manager.py      # 源管理器（統一相機/視頻）
│   └── detection.py           # 檢測控制器
├── ui/
│   ├── main_window_v2.py      # ✅ 主窗口（V2）
│   └── widgets/               # UI 組件
│       ├── camera_control.py  # 相機控制組件
│       ├── video_display.py   # 視頻顯示組件
│       ├── detection_control.py # 檢測控制組件
│       ├── recording_control.py # 錄影控制組件
│       └── system_monitor.py  # 系統監控組件
└── recordings/                # 錄製視頻存儲目錄
```

---

## 🆚 功能對比

| 功能 | V1 (main.py) | V2 (main_v2.py) |
|------|--------------|-----------------|
| **相機支持** | ✅ | ✅ |
| **視頻支持** | ❌ | ✅ |
| **檢測算法** | ❌ 未實現 | ✅ 3種算法 |
| **專業界面** | ⚠️ 基礎 | ✅ 專業 |
| **菜單欄** | ⚠️ 簡單 | ✅ 完整 |
| **測試便利** | ❌ 需要相機 | ✅ 視頻測試 |
| **視頻錄製** | ❌ | ✅ 完整功能 |

**推薦使用 V2 版本！**

---

## 🔧 常見問題

### Q: 如何測試檢測功能？

**A**: 使用視頻模式：

```bash
# 1. 啟動應用
python basler_pyqt6/main_v2.py

# 2. 文件 > 加載視頻文件
# 選擇你的測試視頻

# 3. 播放並啟用檢測
```

### Q: 背景減除適合什麼場景？

**A**: 特別適合：
- 小零件檢測
- 運動物體追蹤
- 傳送帶上的物品計數
- 背景固定的場景

### Q: 如何找到測試視頻？

**A**: 查看這些目錄：
```bash
basler_mvc/recordings/       # 舊版錄製的視頻
recordings/                  # 可能的錄製目錄
```

或使用任何 MP4/AVI 視頻文件

### Q: 檢測參數怎麼調？

**A**: 暫時需要修改代碼：
```python
# basler_pyqt6/core/detection.py
# 修改 self.params 字典
```

未來可以添加參數調整 UI

---

## 📦 打包成 .exe

```bash
# 安裝 PyInstaller
pip install pyinstaller

# 打包 V2 專業版
pyinstaller \
    --name="Basler視覺系統專業版" \
    --onefile \
    --windowed \
    basler_pyqt6/main_v2.py

# 生成文件
dist/Basler視覺系統專業版.exe
```

---

## 🎉 總結

### ✅ 已完成功能

1. **雙模式輸入** - 相機/視頻切換
2. **三種檢測算法** - 圓形/輪廓/背景減除
3. **實時監控** - FPS/CPU/記憶體
4. **專業化界面** - 暗色主題/菜單欄/狀態欄
5. **測試友好** - 無需相機即可測試
6. **視頻錄製** - 支持高速錄製（mp4v/MJPG/XVID編碼器）

### ⚠️ 待實現功能

- 批次處理
- 參數調整面板
- 檢測結果導出

---

## 🚀 立即開始

```bash
# 運行專業版
python basler_pyqt6/main_v2.py

# 加載視頻測試
文件 > 加載視頻文件...

# 啟用檢測
檢測面板 > 選擇方法 > 啟用檢測
```

享受專業的工業視覺體驗！ 🎯
