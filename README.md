# 🏭 Basler 工業視覺系統 - PyQt6 專業版

> 高性能桌面應用，支持 Basler 工業相機實時檢測與視頻錄製

## ✨ 核心特性

- **🎬 雙模式支持**：支持實體相機和視頻文件兩種輸入源
- **🔍 智能檢測**：內建圓形、輪廓、背景減除三種檢測算法
- **🎥 高速錄製**：支持 280+ FPS 高速視頻錄製
- **📊 實時監控**：CPU/記憶體使用率、FPS、檢測計數
- **🎨 專業界面**：暗色主題、三欄佈局、工業級設計

## 🚀 快速開始

### 安裝依賴

```bash
pip install -r requirements.txt
```

### 運行應用

```bash
# 方式 1: 使用 Python 直接運行
python basler_pyqt6/main_v2.py

# 方式 2: 使用啟動腳本（Mac/Linux）
./run_pyqt6.sh
```

### 測試模式（無需實體相機）

1. 啟動應用
2. 選擇 **文件 > 加載視頻文件**
3. 選擇測試視頻
4. 點擊 **▶️ 播放**
5. 啟用檢測查看效果

## 📖 詳細文檔

- [完整功能說明](PYQT6_PROFESSIONAL.md) - 所有功能的詳細介紹
- [PyQt6 開發指南](README_PYQT6.md) - 技術架構和開發說明

## 🎯 主要功能

### 1. 相機模式

支持 Basler acA640-300gm 工業相機：
- 280+ FPS 高速抓取
- 實時曝光調整
- 640x480 Mono8 格式

### 2. 視頻模式

無需實體相機即可測試：
- 支持 MP4/AVI 格式
- 循環播放
- 完整檢測功能

### 3. 檢測算法

**圓形檢測**
- 霍夫圓變換
- 適合圓形零件
- 可調參數範圍

**輪廓檢測**
- 形態學處理
- 適合不規則形狀
- 閾值自定義

**背景減除（推薦）**
- MOG2 背景建模
- 專為小零件設計
- 自動適應背景變化

### 4. 視頻錄製

- 智能編碼器選擇（mp4v/MJPG/XVID）
- 自動適應幀率和尺寸
- 支持錄製帶檢測標記的視頻
- 實時幀計數顯示
- 詳細統計信息

## 📁 專案結構

```
basler_pyqt6/
├── main_v2.py                 # 主程序入口
├── core/                      # 核心邏輯
│   ├── camera.py              # 相機控制器
│   ├── video_player.py        # 視頻播放器
│   ├── video_recorder.py      # 視頻錄製器
│   ├── source_manager.py      # 源管理器
│   └── detection.py           # 檢測控制器
├── ui/                        # 用戶界面
│   ├── main_window_v2.py      # 主窗口
│   └── widgets/               # UI 組件
└── recordings/                # 錄製視頻輸出
```

## 🔧 系統需求

- **Python**: 3.8+
- **操作系統**: Windows / macOS / Linux
- **相機（可選）**: Basler acA640-300gm 或其他 Basler GigE 相機
- **記憶體**: 建議 4GB+
- **處理器**: 支持 AVX 的 CPU（檢測功能需要）

## 📦 核心依賴

- **PyQt6**: 桌面 GUI 框架
- **OpenCV**: 圖像處理和檢測
- **NumPy**: 數值計算
- **pypylon**: Basler 相機 SDK
- **psutil**: 系統監控

## 💡 使用提示

### 測試檢測功能

```bash
# 1. 啟動應用
python basler_pyqt6/main_v2.py

# 2. 加載視頻文件
文件 > 加載視頻文件... > 選擇測試視頻

# 3. 啟用檢測
檢測面板 > 選擇方法（推薦：背景減除）> 啟用檢測

# 4. 播放查看效果
```

### 錄製視頻

```bash
# 1. 啟動視頻源（相機或視頻文件）
# 2. （可選）啟用檢測
# 3. 錄影控制 > 開始錄製
# 4. 停止錄製 > 查看統計信息
# 5. 文件保存在 basler_pyqt6/recordings/
```

### 調整檢測參數

目前需要修改代碼（未來將添加 UI 面板）：

```python
# 編輯 basler_pyqt6/core/detection.py
self.params = {
    'min_area': 100,      # 最小面積
    'max_area': 5000,     # 最大面積
    # ... 其他參數
}
```

## 🐛 常見問題

**Q: 相機無法連接？**
- 確認已安裝 pypylon: `pip install pypylon`
- 檢查相機電源和網絡連接
- 啟用 Jumbo Frames (MTU 9000)

**Q: 檢測效果不佳？**
- 嘗試不同的檢測方法
- 調整參數（min_area, max_area）
- 背景減除最適合小零件檢測

**Q: 錄製的視頻無法播放？**
- 嘗試不同的播放器（VLC 推薦）
- 檢查日誌中的編碼器信息
- mp4v 編碼器品質最高

## 📝 版本信息

**當前版本**: 2.0 (PyQt6 Professional)

**更新日誌**:
- ✅ 完整視頻錄製功能
- ✅ 三種檢測算法
- ✅ 雙模式輸入支持
- ✅ 專業化界面設計
- ✅ 實時性能監控

## 📄 授權

本專案為工業視覺監控系統，用於生產線自動化檢測。

## 🤝 貢獻

歡迎提交問題和改進建議！
